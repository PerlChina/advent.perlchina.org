<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Pod::Advent 0.21 (Pod::Simple 3.13, Perl::Tidy 20090616) on 2010-12-20 20:11:31 -->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>2010 Perl Advent Calendar: PDF::API2</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" href="../style.css" type="text/css" />
<link rel="alternate" type="text/plain" href="PDF-API2.pod" />
</head>
<body>
<h1><a href="../">Perl Advent Calendar 2010-12</a>-21</h1>
<h2 align="center">PDF::API2</h2>
<h3 align="center">by Joe Jiang</h3>
<p><tt><a href="http://search.cpan.org/perldoc?PDF::API2">PDF::API2</a></tt> 是久负盛名的 PDF 处理利器，我们这里演示的是如何用它来追踪 PDF 侵权的用户。</p>
<pre><span class="c">#!/usr/bin/perl -w

use strict;
use PDF::API2;

my $file=PDF::API2->openScalar(do{join(q(),<STDIN>)});

my $font=$file->corefont(q(Courier));

do {my $t=$_->text; $t->font($font, 8); $t->fillcolor(q(white)); $t->translate(40,10); $t->text(q(Hello world))} for map {$file->openpage($_)} 1..$file->pages;

print $file->stringify;</span></pre>
<p>这段代码能从标准输入读取 PDF 文件，只要它没有被加过密，就可以在它每一页的相对位置 40,10 处用白色字体打印 Hello World，然后用 stringfy 和 print 输出到标准输出。只要重定向到文件，就可以储存下来。假如我们把以上的代码储存为 watermark.pl，那么就可以这样调用：</p>
<pre><span class="c">$ cat abc.pdf | ./watermark.pl > def.pdf</span></pre>
<p>现在，因为大多数的 PDF 是用白色作为背景色，那么页脚处的 Hello world 就不容易被发现，然后你可以在网上设置一个收索机器人，专门搜索内含此字的 PDF 文件，那就是被人盗用的。如果其中加入用户的帐号、下载日期等等，就可以用来作为追诉的依据。Thanks Alfred & the community!</p>
<div style="float: right; font-size: 10pt"><a href="PDF-API2.pod">View Source (POD)</a></div><br />
</body>
</html>
