<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Pod::Advent 0.21 (Pod::Simple 3.13, Perl::Tidy 20090616) on 2010-12-09 05:32:19 -->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>2010 Perl Advent Calendar: Regexp::Common</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" href="../style.css" type="text/css" />
<link rel="alternate" type="text/plain" href="RegexpCommon.pod" />
</head>
<body>
<h1><a href="../">Perl Advent Calendar 2010-12</a>-09</h1>
<h2 align="center">Regexp::Common</h2>
<h3 align="center">by Fayland Lam</h3>
<p>正则表达式应该算是 Perl 的强项之一。CPAN 提供了一些常见的 Regex 来匹配常用功能。</p>
<p>比如 URL, 我们就可以用 <tt><a href="http://search.cpan.org/perldoc?Regexp::Common">Regexp::Common</a></tt></p>
<pre>
<span class="k">use</span> <span class="w">Regexp::Common</span> <span class="q">qw /URI/</span><span class="sc">;</span>

<span class="i">$url</span> =~ <span class="q">/$RE{URI}{HTTP}/</span> <span class="k">and</span>  <span class="k">print</span> <span class="q">&quot;Contains an HTTP URI.\n&quot;</span><span class="sc">;</span>
</pre>

<p>比如 email, 我们可以用 <tt><a href="http://search.cpan.org/perldoc?Email::Valid">Email::Valid</a></tt> 或 <tt><a href="http://search.cpan.org/perldoc?Email::Valid::Loose">Email::Valid::Loose</a></tt></p>
<pre>
<span class="k">use</span> <span class="w">Email::Valid</span><span class="sc">;</span>
<span class="w">Email::Valid</span><span class="w">-&gt;address</span><span class="s">(</span><span class="q">&#39;maurice@hevanet.com&#39;</span><span class="s">)</span> <span class="k">and</span> <span class="k">print</span> <span class="q">&quot;that&#39;s an email\n&quot;</span><span class="sc">;</span>
</pre>

<p>下面重点介绍一下 <tt><a href="http://search.cpan.org/perldoc?Regexp::Common::balanced">Regexp::Common::balanced</a></tt>, 这是个很有用的模块，可以匹配括号甚至更多东西。有时候我们需要在一段文字里随机生成另一段文字的话，可以尝试下这个模块。</p>
<pre>
<span class="k">use</span> <span class="w">Regexp::Common</span> <span class="q">qw /balanced/</span><span class="sc">;</span>

<span class="k">my</span> <span class="i">$text</span> = <span class="h">&lt;&lt;&#39;TEXT&#39;</span><span class="sc">;</span>
<span class="hh">Hello {Perl|World|PerlChina}!</span>
<span class="hh">Welcome to (earth|mars|heaven).</span>
<span class="h">TEXT</span>

<span class="i">$text</span> =~ <span class="q">s/$RE{balanced}{-parens=&gt;&#39;{}&#39;}{-keep}/&amp;randpick($1)/seg</span><span class="sc">;</span>
<span class="i">$text</span> =~ <span class="q">s/$RE{balanced}{-parens=&gt;&#39;()&#39;}{-keep}/&amp;randpick($1, &#39;ucfirst&#39;)/seg</span><span class="sc">;</span>
<a name="randpick"></a><span class="k">sub </span><span class="m">randpick</span> <span class="s">{</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$t</span><span class="cm">,</span> <span class="i">$more</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
    <span class="i">$t</span> =~ <span class="q">s/(^[\{\(]|[\}\)]$)//g</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">@a</span> = <span class="k">split</span><span class="s">(</span><span class="q">/\|/</span><span class="cm">,</span> <span class="i">$t</span><span class="s">)</span><span class="sc">;</span>
    <span class="i">@a</span> = <span class="k">grep</span> <span class="s">{</span> <span class="k">length</span><span class="s">(</span><span class="i">$_</span><span class="s">)</span> <span class="s">}</span> <span class="i">@a</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$a</span> = <span class="i">$a</span>[<span class="k">rand</span><span class="s">(</span><span class="k">scalar</span><span class="s">(</span><span class="i">@a</span><span class="s">)</span><span class="s">)</span>]<span class="sc">;</span>
    <span class="k">return</span> <span class="i">$more</span> <span class="k">eq</span> <span class="q">&#39;ucfirst&#39;</span> ? <span class="k">ucfirst</span><span class="s">(</span><span class="i">$a</span><span class="s">)</span> <span class="co">:</span> <span class="i">$a</span><span class="sc">;</span>
<span class="s">}</span>

<span class="k">print</span> <span class="i">$text</span><span class="sc">;</span>
</pre>

<p>运行一下，每次的输出应该是不一样的。</p>
<pre><span class="c">Hello PerlChina!
Welcome to Mars.</span></pre>
<p>Enjoy!</p>
<div style="float: right; font-size: 10pt"><a href="RegexpCommon.pod">View Source (POD)</a></div><br />
</body>
</html>
