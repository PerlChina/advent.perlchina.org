<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Pod::Advent 0.21 (Pod::Simple 3.13, Perl::Tidy 20090616) on 2010-12-10 05:57:30 -->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>2010 Perl Advent Calendar: Furl</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" href="../style.css" type="text/css" />
<link rel="alternate" type="text/plain" href="Furl.pod" />
</head>
<body>
<h1><a href="index.html">Perl Advent Calendar 2010-12</a>-10</h1>
<h2 align="center">Furl</h2>
<h3 align="center">by Fayland Lam</h3>
<p><tt><a href="http://search.cpan.org/perldoc?LWP::UserAgent">LWP::UserAgent</a></tt> 是最基础的 Perl 抓取工具。<tt><a href="http://search.cpan.org/perldoc?WWW::Mechanize">WWW::Mechanize</a></tt> 在此基础上通过 <tt><a href="http://search.cpan.org/perldoc?HTML::Form">HTML::Form</a></tt> 来提供提交表单和其他一些功能。</p>
<p>今天要介绍的是 <tt><a href="http://search.cpan.org/perldoc?Furl">Furl</a></tt>，一个更快速的解决方案。</p>
<p>Furl 提供了一个大致兼容的方案：</p>
<pre>
    <span class="k">use</span> <span class="w">Furl</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$furl</span> = <span class="w">Furl</span><span class="w">-&gt;new</span><span class="s">(</span>
        <span class="w">agent</span>   <span class="cm">=&gt;</span> <span class="q">&#39;MyGreatUA/2.0&#39;</span><span class="cm">,</span>
        <span class="w">timeout</span> <span class="cm">=&gt;</span> <span class="n">10</span><span class="cm">,</span>
    <span class="s">)</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$res</span> = <span class="i">$furl</span><span class="i">-&gt;get</span><span class="s">(</span><span class="q">&#39;http://example.com/&#39;</span><span class="s">)</span><span class="sc">;</span>
    <span class="k">die</span> <span class="i">$res</span><span class="i">-&gt;status_line</span> <span class="k">unless</span> <span class="i">$res</span><span class="i">-&gt;is_success</span><span class="sc">;</span>
    <span class="k">print</span> <span class="i">$res</span><span class="i">-&gt;content</span><span class="sc">;</span>
</pre>

<p>该方案无需太多修改而获得加速。如果上述方案还无法满足需求的话，可以试试更底层的 <tt><a href="http://search.cpan.org/perldoc?Furl::HTTP">Furl::HTTP</a></tt>，该模块通过不构建 Response 来获得加速。</p>
<pre>
    <span class="k">use</span> <span class="w">Furl</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$furl</span> = <span class="w">Furl::HTTP</span><span class="w">-&gt;new</span><span class="s">(</span>
        <span class="w">agent</span>   <span class="cm">=&gt;</span> <span class="q">&#39;MyGreatUA/2.0&#39;</span><span class="cm">,</span>
        <span class="w">timeout</span> <span class="cm">=&gt;</span> <span class="n">10</span><span class="cm">,</span>
    <span class="s">)</span><span class="sc">;</span>

    <span class="k">my</span> <span class="s">(</span><span class="i">$minor_version</span><span class="cm">,</span> <span class="i">$code</span><span class="cm">,</span> <span class="i">$msg</span><span class="cm">,</span> <span class="i">$headers</span><span class="cm">,</span> <span class="i">$body</span><span class="s">)</span> = <span class="i">$furl</span><span class="i">-&gt;request</span><span class="s">(</span>
        <span class="w">method</span> <span class="cm">=&gt;</span> <span class="q">&#39;GET&#39;</span><span class="cm">,</span>
        <span class="w">host</span>   <span class="cm">=&gt;</span> <span class="q">&#39;example.com&#39;</span><span class="cm">,</span>
        <span class="w">port</span>   <span class="cm">=&gt;</span> <span class="n">80</span><span class="cm">,</span>
        <span class="w">path</span>   <span class="cm">=&gt;</span> <span class="q">&#39;/&#39;</span>
    <span class="s">)</span><span class="sc">;</span>
</pre>

<p>当然 Furl 在获得加速的同时，可能放弃了对某些所需的直接支持。比如 Cookie 和 gzip 等。</p>
<p>工具只是工具，高手和新手的最大区别只是在于正确的时间选择正确的工具。:)</p>
<p>Enjoy.</p>
<div style="float: right; font-size: 10pt"><a href="Furl.pod">View Source (POD)</a></div><br />
</body>
</html>
