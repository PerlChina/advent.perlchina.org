<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Pod::Advent 0.18 (Pod::Simple 3.07, Perl::Tidy 20071205) on 2009-12-20 21:45:58 -->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<title>2009 CN Perl Advent Calendar: Template::Extract</title>
<link rel="stylesheet" href="../style.css" type="text/css" />
<link rel="alternate" type="text/plain" href="TemplateExtract.pod" />
</head>
<body>
<h1><a href="../">CN Perl Advent Calendar 2009-12</a>-21</h1>
<h2 align="center">Template::Extract</h2>
<h3 align="center">by Fayland Lam</h3>
<p><tt><a href="http://search.cpan.org/perldoc?Template::Extract">Template::Extract</a></tt> 由☻ 唐鳳 ☺ 所编写，可以使用 TT2 表达式从某个数据里提取东西，而无须使用正则表达式。</p>
<p>一般来说，得到一个 HTML 内容之后，可以使用正则，或者类如 <tt><a href="http://search.cpan.org/perldoc?HTML::TreeBuilder">HTML::TreeBuilder</a></tt> 之类的模块来提取数据。本文介绍的模块能同样使 job 完成，并且更加优雅。</p>
<p>以我们当前的 <a href="http://perlchina.org/advent/">http://perlchina.org/advent/</a> 举例，得到所有的 link 和对应的编号。</p>
<pre>
   1 <span class="k">use</span> <span class="w">strict</span><span class="sc">;</span>
   2 <span class="k">use</span> <span class="w">warnings</span><span class="sc">;</span>
   3 <span class="k">use</span> <span class="w">LWP::Simple</span> <span class="q">&#39;get&#39;</span><span class="sc">;</span>
   4 <span class="k">use</span> <span class="w">Template::Extract</span><span class="sc">;</span>
   5 <span class="k">use</span> <span class="w">Data::Dumper::Perltidy</span><span class="sc">;</span> <span class="c"># or just Data::Dumper</span>
   6 
   7 <span class="k">my</span> <span class="i">$html</span> = <span class="i">get</span><span class="s">(</span><span class="q">&#39;http://perlchina.org/advent/&#39;</span><span class="s">)</span><span class="sc">;</span>
   8 <span class="k">my</span> <span class="i">$rule</span> = <span class="h">&lt;&lt;RULE</span><span class="sc">;</span>
   9 <span class="hh">[% FOREACH link IN links %]</span>
  10 <span class="hh">&lt;br&gt;&lt;div class=&quot;[% ... %]&quot;&gt;&lt;a href=&quot;[% link.url %]&quot; style=&quot;[% ... %]&quot;&gt;[% link.num %]&lt;/a&gt;&lt;/div&gt;</span>
  11 <span class="hh">[% END %]</span>
  12 <span class="h">RULE</span>
  13 
  14 <span class="k">my</span> <span class="i">$extract</span> = <span class="w">Template::Extract</span><span class="w">-&gt;new</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  15 <span class="k">my</span> <span class="i">$data</span> = <span class="i">$extract</span><span class="i">-&gt;extract</span><span class="s">(</span><span class="i">$rule</span><span class="cm">,</span> <span class="i">$html</span><span class="s">)</span><span class="sc">;</span>
  16 <span class="k">print</span> <span class="i">Dumper</span><span class="s">(</span>\<span class="i">$data</span><span class="s">)</span><span class="sc">;</span>
</pre>

<p>运行一下：</p>
<pre><span class="c">$VAR1 = \{
    'links' => [
        {
            'link' => {
                'num' => '1',
                'url' => '2009/local_lib.html'
            }
        },
        {
            'link' => {
                'num' => '2',
                'url' => '2009/PerlDevENV.html'
            }
        },
        {
            'link' => {
                'num' => '3',
                'url' => '2009/EndScope.html'
            }
        },
        {
            'link' => {
                'num' => '4',
                'url' => '2009/autodie.html'
            }
        },
        {
            'link' => {
                'num' => '5',
                'url' => '2009/SSHBatch.html'
            }
        },
...</span></pre>
<p>代码简单可靠。:) Enjoy</p>
<p>谢谢。</p>
<div style="float: right; font-size: 10pt"><a href="TemplateExtract.pod">View Source (POD)</a></div><br />
</body>
</html>
