<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Pod::Advent 0.24 (Pod::Simple 3.07, Perl::Tidy 20101217) on 2011-12-05 14:24:56 -->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>2011 Perl Advent Calendar: Data::MessagePack</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" href="../style.css" type="text/css" />
<link rel="alternate" type="text/plain" href="MessagePack.pod" />
</head>
<body>
<h1><a href="../">Perl Advent Calendar 2011-12</a>-05</h1>
<h2 align="center">Data::MessagePack</h2>
<h3 align="center">by Fayland Lam</h3>
<p>很多时候我们经常会碰到，要将某个对象或者变量保存起来，然后在另外的时间或者地点重新使用它。这种用途非常广泛，但是您可能没有发现。比如当您用 Cache 模块的时候，我们都需要将要保存的东西先转化成 binary 或者文本格式，然后再保存到缓存里。</p>
<p>在计算机世界，这种做法叫做 <span style="font-weight: bold">serialize</span>。</p>
<p>Perl 里最常见的是 <tt><a href="http://search.cpan.org/perldoc?Storable" title="Storable">Storable</a></tt>。Storable 很古老但却最常用。它的缺点之一是不垮语言的。你无法用其他语言来 deserialize 出保存的东西。但是它很强大，可以 serialize 复杂的模块实例。</p>
<p>另外常用的有 <tt><a href="http://search.cpan.org/perldoc?JSON" title="JSON">JSON</a></tt> 甚至 <tt><a href="http://search.cpan.org/perldoc?YAML" title="YAML">YAML</a></tt>。JSON 更流行一些。它们的优点在于不 deserialize 也可以直接看到内容。</p>
<p>而今天我们要介绍的是 <tt><a href="http://search.cpan.org/perldoc?Data::MessagePack" title="Data::MessagePack">Data::MessagePack</a></tt>。它相对 JSON 的优点在于小（节省内存）而且快速。它也是跨语言的，大部分流行的语言支持都可以在 <a href="http://msgpack.org/">http://msgpack.org/</a> 里找到。</p>
<p>它的 RPC 实现是 <tt><a href="http://search.cpan.org/perldoc?AnyEvent::MPRPC" title="AnyEvent::MPRPC">AnyEvent::MPRPC</a></tt>。</p>
<p>使用例子摘抄 perldoc:</p>
<pre>
<span class="k">use</span> <span class="w">Data::MessagePack</span><span class="sc">;</span>

<span class="k">my</span> <span class="i">$mp</span> = <span class="w">Data::MessagePack</span><span class="w">-&gt;new</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
<span class="i">$mp</span><span class="i">-&gt;canonical</span><span class="i">-&gt;utf8</span><span class="i">-&gt;prefer_integer</span> <span class="k">if</span> <span class="i">$needed</span><span class="sc">;</span>

<span class="k">my</span> <span class="i">$packed</span>   = <span class="i">$mp</span><span class="i">-&gt;pack</span><span class="s">(</span><span class="i">$dat</span><span class="s">)</span><span class="sc">;</span>
<span class="k">my</span> <span class="i">$unpacked</span> = <span class="i">$mp</span><span class="i">-&gt;unpack</span><span class="s">(</span><span class="i">$dat</span><span class="s">)</span><span class="sc">;</span>
</pre>

<p>更多更详细的可以查阅模块文档和 msgpack.org 网站。</p>
<p>谢谢。</p>
<div style="float: right; font-size: 10pt"><a href="MessagePack.pod">View Source (POD)</a></div><br />
</body>
</html>
