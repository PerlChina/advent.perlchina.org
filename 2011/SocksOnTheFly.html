<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Pod::Advent 0.24 (Pod::Simple 3.07, Perl::Tidy 20101217) on 2011-12-01 10:50:31 -->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>2011 Perl Advent Calendar: Socks on the fly</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" href="../style.css" type="text/css" />
<link rel="alternate" type="text/plain" href="SocksOnTheFly.pod" />
</head>
<body>
<h1><a href="../">Perl Advent Calendar 2011-12</a>-01</h1>
<h2 align="center">Socks on the fly</h2>
<h3 align="center">by Fayland Lam</h3>
<p>去年的 <a href="../2010/">Advent</a> 我们讲过如果在 http/https 上铺上一层 <a href="../2010/Tor.html">Tor</a>. 这次我们将更近一步，谈论如果在 Socket 上用上 socks proxy.</p>
<p>此次主角便是 <tt><a href="http://search.cpan.org/perldoc?IO::Socket::Socks::Wrapper" title="IO::Socket::Socks::Wrapper">IO::Socket::Socks::Wrapper</a></tt>，无需更改所需模块的源码，轻松简易加套。</p>
<p>如下例子是使用 <tt><a href="http://search.cpan.org/perldoc?Net::Whois::Raw" title="Net::Whois::Raw">Net::Whois::Raw</a></tt>。</p>
<p>查看它的源码，可以发现在 sub whois_query 里有 IO::Socket::INET->new 链接。所以在该 Socket 上使用 socks proxy 就变得非常简单。</p>
<pre><span class="c">use strict;
use warnings;
use Net::Whois::Raw;
use IO::Socket::Socks::Wrapper (
    'Net::Whois::Raw::whois_query()' => {
        ProxyAddr => '127.0.0.1',
        ProxyPort => 7070,
    },
);

my $dominfo = whois('perlchina.org');
print $dominfo;</span></pre>
<p>如果你有 monitor socks proxy 的工具，你就会发现该 whois query 是通过了本地的 7070 端口。</p>
<p>谢谢。</p>
<div style="float: right; font-size: 10pt"><a href="SocksOnTheFly.pod">View Source (POD)</a></div><br />
</body>
</html>
