<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Pod::Advent 0.24 (Pod::Simple 3.13, Perl::Tidy 20101217) on 2011-12-16 18:59:52 -->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>2011 Perl Advent Calendar: List::MoreUtils</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" href="../style.css" type="text/css" />
<link rel="alternate" type="text/plain" href="ListMoreUtils.pod" />
</head>
<body>
<h1><a href="../">Perl Advent Calendar 2011-12</a>-15</h1>
<h2 align="center">List::MoreUtils</h2>
<h3 align="center">by Joe Jiang</h3>
<p>对于大多数人来说，列表的处理是最让人头疼的一件事了，因为循环、变量一类的逻辑非常难以调试。而 <tt><a href="http://search.cpan.org/perldoc?List::MoreUtils" title="List::MoreUtils">List::MoreUtils</a></tt> 则提供了一个简洁的接口，帮助我们进行高效的开发。</p>
<p>这里就用其中一个有用的函数 natatime 作为例子介绍这个常用的模块。</p>
<p>我们常常遇到的一个情况是，通过 Perl 生成 shell 脚本，然后用 shell 来执行。</p>
<pre>
  <span class="i">% perl</span> -<span class="k">le</span> <span class="q">&#39;...&#39;</span> &gt; <span class="w">todo</span>.<span class="w">sh</span>
  % <span class="w">source</span> <span class="w">todo</span>.<span class="w">sh</span>
</pre>

<p>如果 todo.sh 里面某一行有许多的参数，比如 md5sum 1.txt 2.txt ... 9999.txt，这就可能导致一个问题，那就是命令行过长：</p>
<pre>
  <span class="i">% md5sum</span> *
  -<span class="w">bash</span><span class="co">:</span> <span class="q">/usr/</span><span class="w">bin</span>/<span class="w">md5sum</span><span class="co">:</span> <span class="w">Argument</span> <span class="w">list</span> <span class="w">too</span> <span class="w">long</span>
</pre>

<p>这样的问题，对于喜欢脚本的你来说，迟早会遇到的。natatime 这个有点大舌头的 not_a_time 函数能够帮助你去分批完成任务。</p>
<pre>
  <span class="i">% seq</span> <span class="n">1</span> <span class="n">30</span> | <span class="w">perl</span> -<span class="w">MList::MoreUtils</span>=<span class="w">natatime</span> -<span class="w">lne</span> <span class="q">&#39;push @all, $_; END{ $i=natatime 10, @all; print join q( ), q(/usr/bin/md5sum), @f while @f=$i-&gt;() }&#39;</span>
  /<span class="w">usr</span>/<span class="w">bin</span>/<span class="w">md5sum</span> <span class="n">1</span> <span class="n">2</span> <span class="n">3</span> <span class="n">4</span> <span class="n">5</span> <span class="n">6</span> <span class="n">7</span> <span class="n">8</span> <span class="n">9</span> <span class="n">10</span>
  /<span class="w">usr</span>/<span class="w">bin</span>/<span class="w">md5sum</span> <span class="n">11</span> <span class="n">12</span> <span class="n">13</span> <span class="n">14</span> <span class="n">15</span> <span class="n">16</span> <span class="n">17</span> <span class="n">18</span> <span class="n">19</span> <span class="n">20</span>
  /<span class="w">usr</span>/<span class="w">bin</span>/<span class="w">md5sum</span> <span class="n">21</span> <span class="n">22</span> <span class="n">23</span> <span class="n">24</span> <span class="n">25</span> <span class="n">26</span> <span class="n">27</span> <span class="n">28</span> <span class="n">29</span> <span class="n">30</span>
</pre>

<p>这里用 natatime(10, @all) 产生了一个 $i 引用的函数，然后反复调用函数，每次产生十个数据，用来生成最终的命令。</p>
<p>另一个有趣的例子是打印日历，如果你常常需要在命令行显示日历的话，可以用下面的代码实现：</p>
<pre>
  <span class="c">#!/usr/bin/perl -l</span>
  <span class="k">use</span> <span class="w">List::MoreUtils</span> <span class="q">qw(natatime)</span><span class="sc">;</span>
  <span class="i">$it</span>=<span class="i">natatime</span><span class="s">(</span><span class="n">7</span><span class="cm">,</span> <span class="s">(</span><span class="q">qw(Sun Mon Tue Wed Thr Fri Sat)</span><span class="cm">,</span> <span class="s">(</span><span class="k">undef</span><span class="s">)</span>x<span class="s">(</span><span class="s">(</span><span class="n">8</span>+<span class="i">@</span>{<span class="s">[</span><span class="k">localtime</span><span class="s">]</span>}[<span class="n">6</span>]-<span class="i">@</span>{<span class="s">[</span><span class="k">localtime</span><span class="s">]</span>}[<span class="n">3</span>]<span class="s">)</span> % <span class="n">7</span><span class="s">)</span><span class="cm">,</span><span class="k">map</span> <span class="s">{</span><span class="q">s{^(@{[localtime]}[3])$}{\1*}</span><span class="sc">;</span> <span class="i">$_</span><span class="s">}</span> <span class="s">(</span><span class="n">1</span>..<span class="n">30</span><span class="s">)</span><span class="s">)</span><span class="s">)</span><span class="sc">;</span> 
  <span class="k">print</span> <span class="k">join</span> <span class="q">qq(\t)</span><span class="cm">,</span> <span class="i">@days</span> <span class="k">while</span> <span class="s">(</span><span class="i">@days</span>=<span class="i">$it</span>-&gt;<span class="s">(</span><span class="s">)</span><span class="s">)</span>
</pre>

<p>运行效果如下：</p>
<pre><span class="c">  Sun     Mon     Tue     Wed     Thr     Fri     Sat
                                  1       2       3
  4       5       6       7       8       9       10
  11      12      13      14      15*     16      17
  18      19      20      21      22      23      24
  25      26      27      28      29      30</span></pre>
<p>需要承认的是，安装 <tt><a href="http://search.cpan.org/perldoc?Calendar::Simple" title="Calendar::Simple">Calendar::Simple</a></tt> 模块也能输出同样功能的脚本 pcal，但是这个脚本毕竟可以在 Windows 下运行。</p>
<p>更多例子可以参考 <a href="http://www.effectiveperlprogramming.com/">http://www.effectiveperlprogramming.com/</a>。</p>
<div style="float: right; font-size: 10pt"><a href="ListMoreUtils.pod">View Source (POD)</a></div><br />
</body>
</html>
