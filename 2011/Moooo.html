<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Pod::Advent 0.24 (Pod::Simple 3.07, Perl::Tidy 20101217) on 2011-12-02 10:31:03 -->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>2011 Perl Advent Calendar: qr/Moo?/</title>
<link rel="stylesheet" href="../style.css" type="text/css" />
<link rel="alternate" type="text/plain" href="Moooo.pod" />
</head>
<body>
<h1><a href="../">Perl Advent Calendar 2011-12</a>-02</h1>
<h2 align="center">qr/Moo?/</h2>
<h3 align="center">by Woosley Xu</h3>
<p>每个人都喜欢面向对象编程，于是每个人都喜欢<a href="Moose">Moose</a>。但是有些时候，Moose 的加载速度成为了我们应用的瓶颈。这时候<a href="Mouse">Mouse</a>出现了，<a href="Class::Accessor">Class::Accessor</a> 出现了。但这还不够，<a href="Mouse">Mouse</a>仍然过于沉重，<a href="Class::Accessor">Class::Accessor</a>仍然只能提供 有限的特性。这时候，<a href="Moo">Moo</a>和<a href="Mo">Mo</a>出现了。</p>
<p><a href="Moo">Moo</a>与<a href="Mouse">Mouse</a>最大的区别是：它完全不提供任何<span style="font-weight: bold">meta object protocol</span>， 因此它的速度更快，体积更小。在将来的1.0版本，它计划可以和<a href="Any::Moose">Any::Moose</a>一 起使用。</p>
<p>如果你仍然觉得<a href="Moo">Moo</a>太过重量级，那么<a href="Mo">Mo</a>是你的下一个选择。<a href="Mo">Mo</a>核心只提 供<span style="font-weight: bold">new</span>，<span style="font-weight: bold">extends</span>，<span style="font-weight: bold">has</span>这些功能，但你可以按照需求加载你所需要的功能 。</p>
<p>use Mo qw'build default builder coerce is required';</p>
<p>sub BUILD { my $self = shift; ... }</p>
<p>你还可以轻松的将<a href="Mo">Mo</a>压缩，然后包括到你的模块中去。</p>
<pre>
&gt;<span class="w">cat</span> <span class="w">A</span>.<span class="w">pm</span>

<a name="package-A"></a><span class="k">package </span><span class="i">A</span><span class="sc">;</span>
<span class="c"># use Mo qw &#39;build default&#39;;</span>

&gt;<span class="w">mo</span>-<span class="w">inline</span> <span class="w">A</span>.<span class="w">pm</span>

&gt;<span class="w">cat</span>  <span class="w">A</span>.<span class="w">pm</span>

<a name="package-A-1"></a><span class="k">package </span><span class="i">A</span><span class="sc">;</span>
<span class="c"># use Mo qw &#39;build default&#39;;</span>
<span class="c">#   The following line of code was produced from the previous line by</span>
<span class="c">#   Mo::Inline version 0.27</span>
<span class="k">no</span> <span class="w">warnings</span><span class="sc">;</span><span class="k">my</span><span class="i">$M</span>=<span class="w">__PACKAGE__</span>.<span class="w">::</span><span class="sc">;</span><span class="i">*</span>{<span class="i">$M</span>.<span class="w">Object::new</span>}=<span class="k">sub</span><span class="s">{</span><span class="k">bless</span><span class="s">{</span><span class="i">@_</span>[<span class="n">1</span>..<span class="i">$#_</span>]<span class="s">}</span><span class="cm">,</span><span class="i">$_</span>[<span class="n">0</span>]<span class="s">}</span><span class="sc">;</span><span class="i">*</span>{<span class="i">$M</span>.<span class="w">import</span>}=<span class="k">sub</span><span class="s">{</span><span class="w">import</span> <span class="w">warnings</span><span class="sc">;</span><span class="i">$^H</span>|=<span class="n">1538</span><span class="sc">;</span><span class="k">my</span><span class="s">(</span><span class="i">$P</span><span class="cm">,</span><span class="i">%e</span><span class="cm">,</span><span class="i">%o</span><span class="s">)</span>=<span class="k">caller</span>.<span class="w">::</span><span class="sc">;</span><span class="k">shift</span><span class="sc">;</span><span class="k">eval</span><span class="q">&quot;no Mo::$_&quot;</span><span class="cm">,</span><span class="i">&amp;</span>{<span class="i">$M</span>.<span class="i">$_</span>.<span class="w">::e</span>}<span class="s">(</span><span class="i">$P</span><span class="cm">,</span>\<span class="i">%e</span><span class="cm">,</span>\<span class="i">%o</span><span class="cm">,</span>\<span class="i">@_</span><span class="s">)</span><span class="k">for</span><span class="i">@_</span><span class="sc">;</span><span class="k">return</span> <span class="k">if</span><span class="i">$e</span>{<span class="w">M</span>}<span class="sc">;</span><span class="i">%e</span>=<span class="s">(</span><span class="w">extends</span><span class="cm">,</span><span class="k">sub</span><span class="s">{</span><span class="k">eval</span><span class="q">&quot;no $_[0]()&quot;</span><span class="sc">;</span><span class="i">@</span>{<span class="i">$P</span>.<span class="w">ISA</span>}=<span class="i">$_</span>[<span class="n">0</span>]<span class="s">}</span><span class="cm">,</span><span class="w">has</span><span class="cm">,</span><span class="k">sub</span><span class="s">{</span><span class="k">my</span><span class="i">$n</span>=<span class="k">shift</span><span class="sc">;</span><span class="k">my</span><span class="i">$m</span>=<span class="k">sub</span><span class="s">{</span><span class="i">$#_</span>?<span class="i">$_</span>[<span class="n">0</span>]{<span class="i">$n</span>}=<span class="i">$_</span>[<span class="n">1</span>]<span class="co">:</span><span class="i">$_</span>[<span class="n">0</span>]{<span class="i">$n</span>}<span class="s">}</span><span class="sc">;</span><span class="i">$m</span>=<span class="i">$o</span>{<span class="i">$_</span>}-&gt;<span class="s">(</span><span class="i">$m</span><span class="cm">,</span><span class="i">$n</span><span class="cm">,</span><span class="i">@_</span><span class="s">)</span><span class="k">for</span> <span class="k">sort</span> <span class="k">keys</span><span class="i">%o</span><span class="sc">;</span><span class="i">*</span>{<span class="i">$P</span>.<span class="i">$n</span>}=<span class="i">$m</span><span class="s">}</span><span class="cm">,</span><span class="i">%e</span><span class="cm">,</span><span class="s">)</span><span class="sc">;</span><span class="i">*</span>{<span class="i">$P</span>.<span class="i">$_</span>}=<span class="i">$e</span>{<span class="i">$_</span>}<span class="k">for</span> <span class="k">keys</span><span class="i">%e</span><span class="sc">;</span><span class="i">@</span>{<span class="i">$P</span>.<span class="w">ISA</span>}=<span class="i">$M</span>.<span class="w">Object</span><span class="s">}</span><span class="sc">;</span><span class="i">*</span>{<span class="i">$M</span>.<span class="q">&#39;build::e&#39;</span>}=<span class="k">sub</span><span class="s">{</span><span class="k">my</span><span class="s">(</span><span class="i">$P</span><span class="cm">,</span><span class="i">$e</span><span class="s">)</span>=<span class="i">@_</span><span class="sc">;</span><span class="i">$e</span>-&gt;{<span class="w">new</span>}=<span class="k">sub</span><span class="s">{</span><span class="i">$c</span>=<span class="k">shift</span><span class="sc">;</span><span class="k">my</span><span class="i">$s</span>=<span class="k">bless</span><span class="s">{</span><span class="i">@_</span><span class="s">}</span><span class="cm">,</span><span class="i">$c</span><span class="sc">;</span><span class="k">my</span><span class="i">@B</span><span class="sc">;</span><span class="k">do</span><span class="s">{</span><span class="i">@B</span>=<span class="s">(</span><span class="i">$c</span>.<span class="w">::BUILD</span><span class="cm">,</span><span class="i">@B</span><span class="s">)</span><span class="s">}</span><span class="k">while</span><span class="s">(</span><span class="i">$c</span><span class="s">)</span>=<span class="i">@</span>{<span class="i">$c</span>.<span class="w">::ISA</span>}<span class="sc">;</span><span class="k">exists</span><span class="i">&amp;$_</span>&amp;&amp;<span class="i">&amp;$_</span><span class="s">(</span><span class="i">$s</span><span class="s">)</span><span class="k">for</span><span class="i">@B</span><span class="sc">;</span><span class="i">$s</span><span class="s">}</span><span class="s">}</span><span class="sc">;</span><span class="i">*</span>{<span class="i">$M</span>.<span class="q">&#39;default::e&#39;</span>}=<span class="k">sub</span><span class="s">{</span><span class="k">my</span><span class="s">(</span><span class="i">$P</span><span class="cm">,</span><span class="i">$e</span><span class="cm">,</span><span class="i">$o</span><span class="s">)</span>=<span class="i">@_</span><span class="sc">;</span><span class="i">$o</span>-&gt;{<span class="w">default</span>}=<span class="k">sub</span><span class="s">{</span><span class="k">my</span><span class="s">(</span><span class="i">$m</span><span class="cm">,</span><span class="i">$n</span><span class="cm">,</span><span class="i">%a</span><span class="s">)</span>=<span class="i">@_</span><span class="sc">;</span><span class="i">$a</span>{<span class="w">default</span>}<span class="k">or</span> <span class="k">return</span><span class="i">$m</span><span class="sc">;</span><span class="k">sub</span><span class="s">{</span><span class="i">$#_</span>?<span class="i">$m</span>-&gt;<span class="s">(</span><span class="i">@_</span><span class="s">)</span><span class="co">:</span>!<span class="k">exists</span><span class="i">$_</span>[<span class="n">0</span>]{<span class="i">$n</span>}?<span class="i">$_</span>[<span class="n">0</span>]{<span class="i">$n</span>}=<span class="i">$a</span>{<span class="w">default</span>}-&gt;<span class="s">(</span><span class="i">@_</span><span class="s">)</span><span class="co">:</span><span class="i">$m</span>-&gt;<span class="s">(</span><span class="i">@_</span><span class="s">)</span><span class="s">}</span><span class="s">}</span><span class="s">}</span><span class="sc">;</span><span class="i">@f</span>=<span class="q">qw[build default]</span><span class="sc">;</span><span class="k">use</span> <span class="w">strict</span><span class="sc">;</span><span class="k">use</span> <span class="w">warnings</span><span class="sc">;</span>
</pre>

<p>从 Moose 到 Moo 到 Mo，下一个会是 M ? :)</p>
<p>谢谢</p>
<h1>POD ERRORS</h1>
<p>Hey! <span style="font-weight: bold">The above document had some coding errors, which are explained below:</span></p>
Around line 22:<p>Unknown directive: =begine</p>
Around line 31:<p>=end code without matching =begin.  (Stack: [empty])</p>
<div style="float: right; font-size: 10pt"><a href="Moooo.pod">View Source (POD)</a></div><br />
</body>
</html>
